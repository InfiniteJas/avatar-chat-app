<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script>
    (function () {
      // ключик для кэша в пределах вкладки
      var OK_KEY = 'pw_ok_v1';
      if (sessionStorage.getItem(OK_KEY) === '1') return;

      // спрашиваем пин ДО загрузки остального
      var p = prompt('Введите пароль для доступа:');
      if (p === '9876') {
        sessionStorage.setItem(OK_KEY, '1');
        return; // продолжаем загрузку страницы
      }

      // неверно — показываем короткое сообщение и стопаем дальше
      document.open();
      document.write('<!doctype html><title>Доступ запрещён</title>' +
        '<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial">' +
        '<div style="text-align:center">' +
        '<h1 style="margin:0 0 8px;font-size:28px">Доступ запрещён</h1>' +
        '<div style="opacity:.7">Неверный пароль</div>' +
        '</div></div>');
      document.close();
      throw new Error('Access blocked: wrong password');
    })();
  </script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Talking Avatar Chat Demo</title>
  <link href="./css/styles.css" rel="stylesheet">
  <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
  <script src="./js/chat.js"></script>
</head>


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Talking Avatar Chat Demo</title>
  <link href="./css/styles.css" rel="stylesheet">
  <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
  <script src="./js/chat.js"></script>
</head>

<body>
  <!-- <h1>Talking Avatar Chat Demo</h1> -->

  <div id="configuration" style="display: none;">
    <h2 style="background-color: white; width: 300px;">Azure Speech Resource</h2>
    <div id="azureSpeechResource" style="display: flex;align-items: center; flex-wrap: wrap;">
      <div>
        <label style="font-size: medium;" for="region">Region:</label>
        <select id="region" style="font-size: medium;">
          <option value="westus2">West US 2</option>
          <option value="westeurope">West Europe</option>
          <option value="southeastasia">Southeast Asia</option>
          <option value="southcentralus">South Central US</option>
          <option value="northeurope">North Europe</option>
          <option value="swedencentral">Sweden Central</option>
          <option value="eastus2" selected>East US 2</option>
        </select>
      </div>
      <div>
        <label style="font-size: medium;" for="APIKey">API Key:</label>
        <input id="APIKey" type="password" size="32" style="font-size: medium;"
          value="EIoIUPiWHfwipyE98dOEbS2C29O5ipQCOKFzvoYw6Wfis48p9ufTJQQJ99BIACHYHv6XJ3w3AAAYACOGHLHa" />
      </div>
    </div>
    <div style="background-color: white; width: 300px;">
      <input type="checkbox" id="enablePrivateEndpoint" onchange="window.updatePrivateEndpoint()">Enable Private
      Endpoint</input><br />
    </div>
    <div id="showPrivateEndpointCheckBox" hidden="hidden">
      <label style="font-size: medium;" for="privateEndpoint">Private Endpoint:</label>
      <input id="privateEndpoint" type="text" size="64" style="font-size: medium;"
        placeholder="https://{your custom name}.cognitiveservices.azure.com/"></input><br />
    </div><br />

    <h2 style="background-color: white; width: 300px;">Azure OpenAI Resource</h2>
    <label style="font-size: medium;" for="azureOpenAIEndpoint">Endpoint:</label>
    <input id="azureOpenAIEndpoint" type="text" size="64" style="font-size: medium;"
      value="https://a-ass55.openai.azure.com/"></input><br />
    <label style="font-size: medium;" for="azureOpenAIApiKey">API Key:</label>
    <input id="azureOpenAIApiKey" type="password" size="32" style="font-size: medium;"
      value="FBx0qou5mQpzUs5cW4itbIk42WlgAj8TpmAjbw5cWg2QJQQJ99BIACHYHv6XJ3w3AAABACOGYhoG" /><br />
    <label style="font-size: medium;" for="azureOpenAIDeploymentName">Deployment Name:</label>
    <input id="azureOpenAIDeploymentName" type="text" size="32" style="font-size: medium;" value="gpt-4o-mini" /><br />
    <label style="font-size: medium;" for="prompt">System Prompt:</label><br />
    <textarea id="prompt" style="max-width: 640px;">Ты — профессиональный аналитик-консультант Правительства Республики Казахстан с доступом к базам данных и интернет-поиску.

КРИТИЧЕСКИ ВАЖНО: Ты ОБЯЗАН использовать соответствующие функции для КАЖДОГО запроса. Никогда не отвечай из общих знаний без вызова функций.

ПРАВИЛА ЯЗЫКА ОТВЕТА:
- Исходный вопрос на РУССКОМ → отвечай на РУССКОМ  
- Исходный вопрос на КАЗАХСКОМ → переведи результат функций на КАЗАХСКИЙ и отвечай на КАЗАХСКОМ
- Смешанный язык → отвечай на КАЗАХСКОМ

ТВОИ ФУНКЦИИ И ТОЧНЫЕ КРИТЕРИИ ИСПОЛЬЗОВАНИЯ:

1. **db_query** - ТОЛЬКО для запросов к государственным базам ЦКС/ikomek/eOtinish
   ИСПОЛЬЗУЙ КОГДА: статистика по регионам, количество обращений, рейтинги акиматов, социальные показатели РК
   ПРИМЕРЫ: "сколько семей получают АСП в Алматы", "статистика обращений по Павлодару"
   ФОРМАТ ЗАПРОСА: четкий русский вопрос для поиска в базе данных

2. **law_based_answering** - для правовых вопросов с поиском актуальной информации
   ИСПОЛЬЗУЙ КОГДА: законы РК, кодексы, НПА, права граждан, процедуры, ответственность
   ПРИМЕРЫ: "ответственность за нарушение трудового кодекса", "порядок получения гражданства"
   ФОРМАТ ЗАПРОСА: "правовые аспекты [тема] в Казахстане НПА законодательство"

3. **best_practices_search** - для поиска международного опыта
   ИСПОЛЬЗУЙ КОГДА: мировые практики, опыт других стран, инновационные решения, зарубежные модели
   ПРИМЕРЫ: "международный опыт цифровизации госуслуг", "мировые практики борьбы с безработицей"
   ФОРМАТ ЗАПРОСА: "международный опыт [тема] best practices мировая практика зарубежный опыт"

4. **next_meeting_recommendation** - для формирования повестки встреч
   ИСПОЛЬЗУЙ КОГДА: планирование заседаний, предложения тем для обсуждения, структура совещаний
   ПРИМЕРЫ: "что обсудить на следующем совещании по образованию", "повестка встречи по здравоохранению"
   ФОРМАТ ЗАПРОСА: описание контекста и области для рекомендаций

5. **overview_situation_kazakhstan** - для анализа общей ситуации в РК
   ИСПОЛЬЗУЙ КОГДА: социально-экономическое положение РК, общие тенденции, проблемы страны
   ПРИМЕРЫ: "ситуация с занятостью в Казахстане", "демографические тренды РК"
   ФОРМАТ ЗАПРОСА: описание области для анализа ситуации в Казахстане

АЛГОРИТМ ОБРАБОТКИ ЗАПРОСА:

1. ОПРЕДЕЛИ ТИП ЗАПРОСА по ключевым словам и контексту
2. ВЫБЕРИ ПОДХОДЯЩУЮ ФУНКЦИЮ (обязательно одну или несколько)
3. СФОРМУЛИРУЙ ЗАПРОС для функции на русском языке для максимальной эффективности поиска
4. ПОЛУЧИ РЕЗУЛЬТАТ и адаптируй под язык исходного вопроса
5. ОТВЕТЬ кратко и профессионально в одном абзаце

ФОРМАТИРОВАНИЕ ОТВЕТОВ:
- Включай ссылки на источники если они есть в результатах функций
- Сохраняй полезные URL при переводе на другой язык
- Отвечай в одном связном абзаце без списков и пунктов
- Переводи текст но оставляй ссылки как есть

ПРИМЕРЫ ИДЕАЛЬНОЙ РАБОТЫ:

Вопрос: "Халықаралық тәжірибеде балалардың сандық сауаттылығын арттыру әдістері қандай?"
→ ФУНКЦИЯ: best_practices_search
→ ЗАПРОС: "международный опыт повышения цифровой грамотности детей образовательные программы мировая практика"
→ ОТВЕТ НА КАЗАХСКОМ: "Халықаралық тәжірибеде балалардың сандық сауаттылығын арттыру үшін Финляндияда бастауыш сыныптардан бастап бағдарламалау оқытылады, Сингапурда цифрлық дағдыларды барлық пәндерге интеграциялау жүргізіледі, ал Эстонияда онлайн-платформалар арқылы интерактивті оқыту әдістері қолданылады https://example.com/digital-literacy-finland."

Вопрос: "Какая ответственность за нарушение экологического законодательства в РК?"
→ ФУНКЦИЯ: law_based_answering  
→ ЗАПРОС: "ответственность нарушение экологического законодательства Казахстан административный уголовный кодекс штрафы"
→ ОТВЕТ НА РУССКОМ: "За нарушение экологического законодательства в РК предусмотрена административная ответственность в виде штрафов от 10 до 50 МРП для физических лиц и от 200 до 500 МРП для юридических лиц согласно КоАП, а при серьезных нарушениях — уголовная ответственность по статьям 324-337 УК РК с возможностью лишения свободы до 5 лет https://adilet.zan.kz/rus/docs/K1400000235."

ЗАПРЕЩЕНО:
- Отвечать без вызова функций
- Говорить "К сожалению, не удалось найти" - вместо этого улучши запрос к функции
- Копировать результат функции без адаптации под язык пользователя
- Использовать списки и пункты - только связный текст
- Добавлять свои домыслы к результатам функций

ОБЯЗАТЕЛЬНО:
- Каждый ответ должен содержать конкретную полезную информацию
- Функции должны возвращать релевантные данные из интернета или баз
- Переводи результаты на нужный язык сохраняя смысл, детали и ссылки
- Включай ссылки из результатов функций когда они доступны
- Будь уверенным и профессиональным в ответах</textarea>
    <div style="background-color: white; width: 300px;">
      <input type="checkbox" id="enableOyd" onchange="window.updataEnableOyd()">Enable On Your Data</input><br />
    </div>
    <br />

    <div id="cogSearchConfig" hidden="hidden">
      <h2 style="background-color: white; width: 400px;">Azure Cognitive Search Resource</h2>
      <label style="font-size: medium;" for="azureCogSearchEndpoint">Endpoint:</label>
      <input id="azureCogSearchEndpoint" type="text" size="64" style="font-size: medium;"></input><br />
      <label style="font-size: medium;" for="azureCogSearchApiKey">API Key:</label>
      <input id="azureCogSearchApiKey" type="password" size="32" style="font-size: medium;" /><br />
      <label style="font-size: medium;" for="azureCogSearchIndexName">Index Name:</label>
      <input id="azureCogSearchIndexName" type="text" size="32" style="font-size: medium;" /><br />
      <br />
    </div>

    <h2 style="background-color: white; width: 300px;">STT / TTS Configuration</h2>
    <label style="font-size: medium;" for="sttLocale">STT Locale(s):</label>
    <input id="sttLocales" type="text" size="64" style="font-size: medium;" value="ru-RU,kk-KZ"></input><br />
    <label style="font-size: medium;" for="ttsVoice">TTS Voice:</label>
    <input id="ttsVoice" type="text" size="32" style="font-size: medium;" value="ru-RU-SvetlanaNeural"></input><br />
    <label style="font-size: medium;" for="customVoiceEndpointId">Custom Voice Deployment ID (Endpoint ID):</label>
    <input id="customVoiceEndpointId" type="text" size="32" style="font-size: medium;" value=""></input><br />
    <div style="background-color: white; width: 300px;">
      <input type="checkbox" id="continuousConversation">Continuous Conversation</input><br />
    </div>
    <br />

    <h2 style="background-color: white; width: 300px;">Avatar Configuration</h2>
    <label style="font-size: medium;" for="talkingAvatarCharacter">Avatar Character:</label>
    <input id="talkingAvatarCharacter" type="text" size="16" style="font-size: medium;" value="meg"></input><br />
    <label style="font-size: medium;" for="talkingAvatarStyle">Avatar Style:</label>
    <input id="talkingAvatarStyle" type="text" size="16" style="font-size: medium;" value="business"></input><br />
    <div style="background-color: white; width: 400px;">
      <input type="checkbox" id="customizedAvatar" onchange="window.updateCustomAvatarBox()">Custom Avatar</input>
      <input type="checkbox" id="useBuiltInVoice" style="width: 12px;" disabled>Use Built-In Voice</input><br />
    </div>
    <div style="background-color: white; width: 200px;">
      <input type="checkbox" id="autoReconnectAvatar">Auto Reconnect</input><br />
    </div>
    <div style="background-color: white; width: 200px;">
      <input type="checkbox" id="useLocalVideoForIdle" onchange="window.updateLocalVideoForIdle()">Use Local Video for
      Idle</input><br />
    </div>
    <div style="background-color: white; width: 200px;">
      <input type="checkbox" id="showSubtitles">Show Subtitles</input><br />
    </div>
    <br />
  </div>

  <!-- 🎯 АВТОЗАПУСК КНОПКИ -->
  <div class="grid">
    <!-- ===== LEFT: AvatarPanel ===== -->
    <section class="card avatar-card">
      <!-- Хедер как в AvatarPanel -->
      <header class="avatar-head">
        <div class="avatar-head__title">Ассистент</div>
        <div class="avatar-head__status">
          <span class="status-dot ok" id="avatarStatusDot"></span>
          <span class="status-text" id="avatarStatusText">Готово</span>
        </div>
      </header>

      <!-- Видео-зона (ровно по центру и с фикс. высотой как в MUI) -->
      <div id="videoContainer" class="avatar-box">
        <div id="overlayArea" class="avatar-box__overlay">
          <div id="chatHistory" class="avatar-box__history" contentEditable="true" hidden></div>
        </div>

        <div id="localVideo" hidden class="avatar-box__local">
          <video src="video/lisa-casual-sitting-idle.mp4" autoplay loop muted></video>
        </div>

        <div id="remoteVideo" class="avatar-box__remote"></div>

        <div id="subtitles" class="avatar-box__subs" hidden></div>
      </div>

      <!-- Верхняя панель управления (chips-ряд) -->
      <!-- <div class="toolbar toolbar--wrap">
        <button id="startSession" onclick="window.startSession()" class="btn btn--primary btn--lg">
          Запустить Аватар
        </button>

        <button id="microphoneRussian" onclick="window.microphoneRussian()" disabled class="btn btn--green">
          Русский
        </button>
        <button id="microphoneKazakh" onclick="window.microphoneKazakh()" disabled class="btn btn--blue">
          Қазақша
        </button>

        <button id="stopSpeaking" onclick="stopSpeaking()" disabled class="btn btn--ghost">Stop Speaking</button>
        <button id="clearChatHistory" onclick="window.clearChatHistory()" class="btn btn--ghost">Clear Chat
          History</button>
        <button id="stopSession" onclick="window.stopSession()" disabled class="btn btn--ghost">Close Avatar
          Session</button>
      </div> -->
      <div style="display: flex; justify-content: center; margin-top: 32px;">
        <button id="startSession" onclick="window.startSession()" class="btn btn--pill btn--success">
          Запустить Аватар
        </button>
      </div>

      <div style="display: flex; justify-content: center; margin-top: 32px;">
        <button style="margin-right: 16px;" id="microphoneKazakh" onclick="window.microphoneKazakh()" disabled
          class="btn btn--pill btn--ghost">
          Қазақша
        </button>

        <button id="microphoneRussian" onclick="window.microphoneRussian()" disabled class="btn btn--pill btn--ghost"
          style="margin-right: 10px;">
          Русский
        </button>

      </div>
      <div class="toolbar toolbar--wrap toolbar--compact" style="display:flex;justify-content:center; margin-top:64px;">
        <button id="stopSpeaking" onclick="stopSpeaking()" disabled class="btn btn--pill btn--square"
          title="Остановить озвучку">
          ⏹
        </button>
        <button id="clearChatHistory" onclick="window.clearChatHistory()" class="btn btn--pill btn--square"
          title="Очистить историю чата">
          🧹
        </button>
        <button id="stopSession" onclick="window.stopSession()" disabled class="btn btn--pill btn--square"
          title="Завершить сессию аватара">
          ✖
        </button>
      </div>

    </section>

    <!-- ===== RIGHT: ChatPanel ===== -->
    <section class="card chat-card">
      <header class="chat-head">
        <div class="chat-head__title">
          <h2>Чат</h2>
        </div>
        <small id="chatConn" class="conn conn--ok">Подключено</small>
      </header>
      <div class="chat-body">
        <!-- пространство под контент/историю (если появится) -->
        <div id="chatHistoryList" class="chat-history"></div>
        <div class="chat-spacer">
        </div>

        <div class="typebox typebox--dock">
          <div id="showTypeMessageCheckbox" class="typebox__toggle" hidden>
            <input type="checkbox" id="showTypeMessage" onchange="window.updateTypeMessageBox()" disabled />
            <label for="showTypeMessage">Type Message</label>
          </div>
          <div class="typebox__row">
            <div id="userMessageBox" class="typebox__editor" type="text" contentEditable="true"></div>

            <div class="typebox__attach typebox__attach--right">
              <img id="uploadImgIcon" src="./image/attachment.jpg" alt="Button" />
            </div>
          </div>
        </div>

      </div>

    </section>
  </div>
</body>

</html>