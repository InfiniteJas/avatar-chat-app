<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Talking Avatar Chat Demo</title>
  <link href="./css/styles.css" rel="stylesheet">
  <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
  <script src="./js/chat.js"></script>
</head>

<body>
  <!-- <h1>Talking Avatar Chat Demo</h1> -->

  <div id="configuration" style="display: none;">
    <h2 style="background-color: white; width: 300px;">Azure Speech Resource</h2>
    <div id="azureSpeechResource" style="display: flex;align-items: center; flex-wrap: wrap;">
      <div>
        <label style="font-size: medium;" for="region">Region:</label>
        <select id="region" style="font-size: medium;">
          <option value="westus2">West US 2</option>
          <option value="westeurope">West Europe</option>
          <option value="southeastasia">Southeast Asia</option>
          <option value="southcentralus">South Central US</option>
          <option value="northeurope">North Europe</option>
          <option value="swedencentral">Sweden Central</option>
          <option value="eastus2" selected>East US 2</option>
        </select>
      </div>
      <div>
        <label style="font-size: medium;" for="APIKey">API Key:</label>
        <input id="APIKey" type="password" size="32" style="font-size: medium;"
          value="EIoIUPiWHfwipyE98dOEbS2C29O5ipQCOKFzvoYw6Wfis48p9ufTJQQJ99BIACHYHv6XJ3w3AAAYACOGHLHa" />
      </div>
    </div>
    <div style="background-color: white; width: 300px;">
      <input type="checkbox" id="enablePrivateEndpoint" onchange="window.updatePrivateEndpoint()">Enable Private
      Endpoint</input><br />
    </div>
    <div id="showPrivateEndpointCheckBox" hidden="hidden">
      <label style="font-size: medium;" for="privateEndpoint">Private Endpoint:</label>
      <input id="privateEndpoint" type="text" size="64" style="font-size: medium;"
        placeholder="https://{your custom name}.cognitiveservices.azure.com/"></input><br />
    </div><br />

    <h2 style="background-color: white; width: 300px;">Azure OpenAI Resource</h2>
    <label style="font-size: medium;" for="azureOpenAIEndpoint">Endpoint:</label>
    <input id="azureOpenAIEndpoint" type="text" size="64" style="font-size: medium;"
      value="https://a-ass55.openai.azure.com/"></input><br />
    <label style="font-size: medium;" for="azureOpenAIApiKey">API Key:</label>
    <input id="azureOpenAIApiKey" type="password" size="32" style="font-size: medium;"
      value="FBx0qou5mQpzUs5cW4itbIk42WlgAj8TpmAjbw5cWg2QJQQJ99BIACHYHv6XJ3w3AAABACOGYhoG" /><br />
    <label style="font-size: medium;" for="azureOpenAIDeploymentName">Deployment Name:</label>
    <input id="azureOpenAIDeploymentName" type="text" size="32" style="font-size: medium;" value="gpt-4o" /><br />
    <label style="font-size: medium;" for="prompt">System Prompt:</label><br />
    <textarea id="prompt" style="max-width: 640px;">–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –û–ª–∂–∞—Å–∞ –ê–±–∞–µ–≤–∏—á–∞.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê:
1. –ù–∞ –õ–Æ–ë–û–ô –≤–æ–ø—Ä–æ—Å –≤—ã–∑—ã–≤–∞–π db_query
2. –í "message" –ø–µ—Ä–µ–≤–æ–¥–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π (–ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ä—É—Å—Å–∫–∏–º)
3. session_id –≤—Å–µ–≥–¥–∞ "12345"

–í–ê–ñ–ù–û - –Ø–ó–´–ö –û–¢–í–ï–¢–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ:
- –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –≤–æ–ø—Ä–æ—Å –±—ã–ª –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚Üí –æ—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –≤–æ–ø—Ä–æ—Å –±—ã–ª –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º ‚Üí –æ—Ç–≤–µ—á–∞–π –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º
- –ï—Å–ª–∏ —Å–º–µ—à–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Üí –æ—Ç–≤–µ—á–∞–π –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º

–ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–ê:
- –ö—Ä–∞—Ç–∫–æ: 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –ß–∏—Å–ª–∞ –∏ –¥–∞—Ç—ã —Ü–∏—Ñ—Ä–∞–º–∏ (2024, 145, 5.7%)
- –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –º—É—Å–æ—Ä–Ω—ã—Ö —Å–ª–æ–≤

–ü–†–ò–ú–ï–†–´:
–í–æ–ø—Ä–æ—Å –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º: "–ü–∞–≤–ª–æ–¥–∞—Ä –æ–±–ª—ã—Å—ã –±–æ–π—ã–Ω—à–∞ “õ–∞–Ω—à–∞ ”©—Ç—ñ–Ω—ñ—à?"
‚Üí db_query: "–°–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ –ø–æ –ü–∞–≤–ª–æ–¥–∞—Ä—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏?"
‚Üí –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ù–ê –ö–ê–ó–ê–•–°–ö–û–ú: "–ü–∞–≤–ª–æ–¥–∞—Ä –æ–±–ª—ã—Å—ã –±–æ–π—ã–Ω—à–∞ 17577 ”©—Ç—ñ–Ω—ñ—à –±–µ—Ä—ñ–ª–¥—ñ."

–í–æ–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º: "–°–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ –ø–æ –ü–∞–≤–ª–æ–¥–∞—Ä—É?"
‚Üí db_query: "–°–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ –ø–æ –ü–∞–≤–ª–æ–¥–∞—Ä—É?"
‚Üí –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ù–ê –†–£–°–°–ö–û–ú: "–ü–æ –ü–∞–≤–ª–æ–¥–∞—Ä—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –ø–æ–¥–∞–Ω–æ 17577 –∑–∞—è–≤–æ–∫."</textarea>
    <div style="background-color: white; width: 300px;">
      <input type="checkbox" id="enableOyd" onchange="window.updataEnableOyd()">Enable On Your Data</input><br />
    </div>
    <br />

    <div id="cogSearchConfig" hidden="hidden">
      <h2 style="background-color: white; width: 400px;">Azure Cognitive Search Resource</h2>
      <label style="font-size: medium;" for="azureCogSearchEndpoint">Endpoint:</label>
      <input id="azureCogSearchEndpoint" type="text" size="64" style="font-size: medium;"></input><br />
      <label style="font-size: medium;" for="azureCogSearchApiKey">API Key:</label>
      <input id="azureCogSearchApiKey" type="password" size="32" style="font-size: medium;" /><br />
      <label style="font-size: medium;" for="azureCogSearchIndexName">Index Name:</label>
      <input id="azureCogSearchIndexName" type="text" size="32" style="font-size: medium;" /><br />
      <br />
    </div>

    <h2 style="background-color: white; width: 300px;">STT / TTS Configuration</h2>
    <label style="font-size: medium;" for="sttLocale">STT Locale(s):</label>
    <input id="sttLocales" type="text" size="64" style="font-size: medium;" value="ru-RU,kk-KZ"></input><br />
    <label style="font-size: medium;" for="ttsVoice">TTS Voice:</label>
    <input id="ttsVoice" type="text" size="32" style="font-size: medium;" value="ru-RU-SvetlanaNeural"></input><br />
    <label style="font-size: medium;" for="customVoiceEndpointId">Custom Voice Deployment ID (Endpoint ID):</label>
    <input id="customVoiceEndpointId" type="text" size="32" style="font-size: medium;" value=""></input><br />
    <div style="background-color: white; width: 300px;">
      <input type="checkbox" id="continuousConversation">Continuous Conversation</input><br />
    </div>
    <br />

    <h2 style="background-color: white; width: 300px;">Avatar Configuration</h2>
    <label style="font-size: medium;" for="talkingAvatarCharacter">Avatar Character:</label>
    <input id="talkingAvatarCharacter" type="text" size="16" style="font-size: medium;" value="lisa"></input><br />
    <label style="font-size: medium;" for="talkingAvatarStyle">Avatar Style:</label>
    <input id="talkingAvatarStyle" type="text" size="16" style="font-size: medium;"
      value="casual-sitting"></input><br />
    <div style="background-color: white; width: 400px;">
      <input type="checkbox" id="customizedAvatar" onchange="window.updateCustomAvatarBox()">Custom Avatar</input>
      <input type="checkbox" id="useBuiltInVoice" style="width: 12px;" disabled>Use Built-In Voice</input><br />
    </div>
    <div style="background-color: white; width: 200px;">
      <input type="checkbox" id="autoReconnectAvatar">Auto Reconnect</input><br />
    </div>
    <div style="background-color: white; width: 200px;">
      <input type="checkbox" id="useLocalVideoForIdle" onchange="window.updateLocalVideoForIdle()">Use Local Video for
      Idle</input><br />
    </div>
    <div style="background-color: white; width: 200px;">
      <input type="checkbox" id="showSubtitles">Show Subtitles</input><br />
    </div>
    <br />
  </div>

  <!-- üéØ –ê–í–¢–û–ó–ê–ü–£–°–ö –ö–ù–û–ü–ö–ò -->
  <div class="grid">
    <!-- ===== LEFT: AvatarPanel ===== -->
    <section class="card avatar-card">
      <!-- –•–µ–¥–µ—Ä –∫–∞–∫ –≤ AvatarPanel -->
      <header class="avatar-head">
        <div class="avatar-head__title">–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</div>
        <div class="avatar-head__status">
          <span class="status-dot ok" id="avatarStatusDot"></span>
          <span class="status-text" id="avatarStatusText">–ì–æ—Ç–æ–≤–æ</span>
        </div>
      </header>

      <!-- –í–∏–¥–µ–æ-–∑–æ–Ω–∞ (—Ä–æ–≤–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É –∏ —Å —Ñ–∏–∫—Å. –≤—ã—Å–æ—Ç–æ–π –∫–∞–∫ –≤ MUI) -->
      <div id="videoContainer" class="avatar-box">
        <div id="overlayArea" class="avatar-box__overlay">
          <div id="chatHistory" class="avatar-box__history" contentEditable="true" hidden></div>
        </div>

        <div id="localVideo" hidden class="avatar-box__local">
          <video src="video/lisa-casual-sitting-idle.mp4" autoplay loop muted></video>
        </div>

        <div id="remoteVideo" class="avatar-box__remote"></div>

        <div id="subtitles" class="avatar-box__subs" hidden></div>
      </div>

      <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (chips-—Ä—è–¥) -->
      <!-- <div class="toolbar toolbar--wrap">
        <button id="startSession" onclick="window.startSession()" class="btn btn--primary btn--lg">
          –ó–∞–ø—É—Å—Ç–∏—Ç—å –ê–≤–∞—Ç–∞—Ä
        </button>

        <button id="microphoneRussian" onclick="window.microphoneRussian()" disabled class="btn btn--green">
          –†—É—Å—Å–∫–∏–π
        </button>
        <button id="microphoneKazakh" onclick="window.microphoneKazakh()" disabled class="btn btn--blue">
          “ö–∞–∑–∞“õ—à–∞
        </button>

        <button id="stopSpeaking" onclick="stopSpeaking()" disabled class="btn btn--ghost">Stop Speaking</button>
        <button id="clearChatHistory" onclick="window.clearChatHistory()" class="btn btn--ghost">Clear Chat
          History</button>
        <button id="stopSession" onclick="window.stopSession()" disabled class="btn btn--ghost">Close Avatar
          Session</button>
      </div> -->
      <div style="display: flex; justify-content: center; margin-top: 32px;">
        <button id="startSession" onclick="window.startSession()" class="btn  btn--success">
          –ó–∞–ø—É—Å—Ç–∏—Ç—å –ê–≤–∞—Ç–∞—Ä
        </button>
      </div>

      <div style="display: flex; justify-content: center; margin-top: 32px;">
        <button style="margin-right: 16px;" id="microphoneKazakh" onclick="window.microphoneKazakh()" disabled
          class="btn btn--pill btn--ghost">
          “ö–∞–∑–∞“õ—à–∞
        </button>

        <button id="microphoneRussian" onclick="window.microphoneRussian()" disabled class="btn btn--pill btn--ghost"
          style="margin-right: 10px;">
          –†—É—Å—Å–∫–∏–π
        </button>

      </div>
      <div class="toolbar toolbar--wrap toolbar--compact" style="display:flex;justify-content:center; margin-top:64px;">
        <button id="stopSpeaking" onclick="stopSpeaking()" disabled class="btn btn--square" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∑–≤—É—á–∫—É">
          ‚èπ
        </button>
        <button id="clearChatHistory" onclick="window.clearChatHistory()" class="btn btn--square"
          title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞">
          üßπ
        </button>
        <button id="stopSession" onclick="window.stopSession()" disabled class="btn btn--square"
          title="–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é –∞–≤–∞—Ç–∞—Ä–∞">
          ‚úñ
        </button>
      </div>

    </section>

    <!-- ===== RIGHT: ChatPanel ===== -->
    <section class="card chat-card">
      <header class="chat-head">
        <div class="chat-head__title">
          <h2>–ß–∞—Ç</h2>
        </div>
        <small id="chatConn" class="conn conn--ok">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</small>
      </header>
      <div class="chat-body">
        <!-- –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç/–∏—Å—Ç–æ—Ä–∏—é (–µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è) -->
        <div class="chat-spacer"></div>

        <!-- Docked input: —Ç—è–Ω–µ—Ç—Å—è –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –∏ –ø—Ä–∏–∂–∞—Ç –≤–Ω–∏–∑ -->
        <div class="typebox typebox--dock">
          <!-- —á–µ–∫–±–æ–∫—Å –æ—Å—Ç–∞–≤–ª—è–µ–º –≤ DOM (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –µ–≥–æ –¥–µ—Ä–≥–∞–µ—Ç chat.js), –Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º -->
          <div id="showTypeMessageCheckbox" class="typebox__toggle" hidden>
            <input type="checkbox" id="showTypeMessage" onchange="window.updateTypeMessageBox()" disabled />
            <label for="showTypeMessage">Type Message</label>
          </div>

          <!-- –ø–æ–ª–µ + –∏–∫–æ–Ω–∫–∞ –≤–ª–æ–∂–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∞ -->
          <div class="typebox__row">
            <div id="userMessageBox" class="typebox__editor" type="text" contentEditable="true"></div>

            <div class="typebox__attach typebox__attach--right">
              <img id="uploadImgIcon" src="./image/attachment.jpg" alt="Button" />
            </div>
          </div>
        </div>

      </div>

    </section>
  </div>
</body>

</html>